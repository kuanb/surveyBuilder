<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-switch.min.css" rel="stylesheet">
<link rel="stylesheet" href="css/survey-style.css">
<title>Flocktracker project builder</title>
</head>
<body>
	<div id="project_container">
		<div class="h4">
			<img id="FT_logo" src="img/ft_logosm.png" alt="Flocktracker Logo"
				align="middle"> Flocktracker project builder
		</div>
		<div id="control_buttons_container">
			<a class="btn btn-success btn-md" id="upload"><span
				class="glyphicon glyphicon-cloud-upload"></span> Upload project!</a> <a
				class="btn btn-primary btn-md" id="undo">Undo <span
				class="glyphicon glyphicon-arrow-left"></span></a> <a
				class="btn btn-primary btn-md" id="redo"><span
				class="glyphicon glyphicon-arrow-right"></span> Redo</a>
		</div>
		<div id="JSON_input_container">
			Welcome! This is a tool to create projects for the Flocktracker Android app.
			It is based on the FlockSON survey markup laguage. <br> We are
			working on a seamless approach for creating and uploading new
			projects for the platform, for now, please email
			daniel.heriberto@smart.mit.edu with the JSON code of your project and
			it's name so we upload it to the database to be used in
			Flocktracker. <br> <br> You can load a previous project by
			pasting it here: <input id="project_input" type="text"
				class="form-control" placeholder="Paste your project here">
			<a class="btn btn-success btn-md" id="parse_button"><span
				class="glyphicon glyphicon-ok"></span> Parse project</a>
		</div>
		<div id="modification_data">
			<b>Input Modification Count:</b> <b id="modification_count">0</b> <br>
			<br> <b>JSON Output:</b><br>
		</div>
		<div id="JsonGoesHere" class="jsonFloat"></div>
	</div>
	<div id="survey_container"></div>
</body>
<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap-switch.min.js"></script>
<script src="js/ul-undo-stack.js"></script>
<script src="js/flockSON-ux-elements.js"></script>
<script src="js/flockSON.js"></script>
<script src="js/flocktracker-project-models.js"></script>
<script src="js/flockSON-survey-builder.js"></script>
<script src="js/flocktracker-project-builder.js"></script>
<script type="text/javascript">
    	this.undoHandler = function(){
	    	this.contentChanged = function(){
	    		that.FTproject = that.projectView.getProject();
				contentChanges++;
				var projectSnapShot = new ftpr.project();
				projectSnapShot.deserializeJSON(FTproject.serializeJSON());
				var newStackElement = new stackElement(projectView, projectSnapShot);
				uStack.addToStack(newStackElement);
				modCount.innerHTML = contentChanges;
				jsonText.innerHTML = JSON.stringify(FTproject.serializeJSON());
				$(undo).attr('disabled', !uStack.isUndoPossible());
				$(redo).attr('disabled', !uStack.isRedoPossible());  
	    	};
    	}
		var superString = '{ "FlocktrackerProject": { "CountersProject": { "Counters": [ { "Counter": { "Name": "Benches", "ID" : "BENCH" } }, { "Counter": { "Name": "Trees", "ID" : "TREE" } }, { "Counter": { "Name": "Shadow places", "ID" : "SHADOW" } } ], "TableID": "1cfIgPxhTCn17wO0O0lmtea-gkoBd7LEACkTC-qTu" }, "SurveyProject": { "Survey": { "Chapters": [ { "Chapter": { "Questions": [ { "Question": { "ID": "q1", "Text": "Where do you live?", "Kind": "MC", "Other": true, "Answers": [ { "Answer": { "Text": "City" } }, { "Answer": { "Text": "Country" } } ] } }, { "Question": { "ID": "q2", "Text": "What’s your house surface area?", "Kind": "ON" } }, { "Question": { "ID": "q3", "Text": "Take a picture of a nearby object", "Kind": "IM" } }, { "Question": { "ID": "q4", "Text": "What food do you like?", "Kind": "CB", "Other": true, "Answers": [ { "Answer": { "Text": "Tacos" } }, { "Answer": { "Text": "Pozole" } }, { "Answer": { "Text": "Carnitas" } } ] } }, { "Question": { "ID": "q5", "Text": "Order the elements of this list in order of importance.", "Kind": "OL", "Answers": [ { "Answer": { "Text": "Security" } }, { "Answer": { "Text": "Comfort" } }, { "Answer": { "Text": "Price" } } ] } } ], "Title": "Chapter 1" } }, { "Chapter": { "Questions": [ { "Question": { "ID": "q6", "Text": "Are you...?", "Kind": "MC", "Other": true, "Answers": [ { "Answer": { "Text": "A woman" } }, { "Answer": { "Text": "A man" } } ] } }, { "Question": { "ID": "q7", "Text": "What’s your name?", "Kind": "OT" } }, { "Question": { "ID": "q8", "Text": "Take a picture of you.", "Kind": "IM" } }, { "Question": { "ID": "q9", "Text": "What music do you like?", "Kind": "CB", "Other": true, "Answers": [ { "Answer": { "Text": "Rock" } }, { "Answer": { "Text": "Country" } }, { "Answer": { "Text": "Polka" } } ] } }, { "Question": { "ID": "q10", "Text": "Order the elements of this list in order of importance.", "Kind": "OL", "Answers": [ { "Answer": { "Text": "Information" } }, { "Answer": { "Text": "Knowledge" } }, { "Answer": { "Text": "Wisdom" } } ] } }, { "Question": { "ID": "q11", "Text": "How many children do you have?", "Kind": "LP", "Questions": [ { "Question": { "ID": "q12", "Text": "Does he or she live with you?", "Kind": "MC", "Other": true, "Answers": [ { "Answer": { "Text": "Yes" } }, { "Answer": { "Text": "No" } } ] } } ] } }, { "Question": { "ID": "q13", "Text": "What’s his or her age?", "Kind": "ON" } }, { "Question": { "ID": "q14", "Text": "Take a picture of him or her.", "Kind": "IM" } }, { "Question": { "ID": "q15", "Text": "What cartoon does he or she like?", "Kind": "CB", "Other": true, "Answers": [ { "Answer": { "Text": "Pokémon" } }, { "Answer": { "Text": "Spirited Away" } }, { "Answer": { "Text": "My Little Pony" } } ] } }, { "Question": { "ID": "q16", "Text": "Order the elements of this list in order of importance for his or her well being", "Kind": "OL", "Answers": [ { "Answer": { "Text": "Nutrition" } }, { "Answer": { "Text": "Education" } }, { "Answer": { "Text": "Leisure time" } } ] } } ], "Title": "Chapter 2" } } ], "flockSONversion": 0.1, "Title": "Survey title" }, "TableID": "1dVcrBq7qAC7wRUl6iVPPTQf4n1qyoZiLZH_bIrdR" }, "TrackerProject": { "StartSurvey": { "Survey": { "Chapters": [ { "Chapter": { "Questions": [ { "Question": { "ID": "q1", "Text": "Where do you live?", "Kind": "MC", "Other": true, "Answers": [ { "Answer": { "Text": "City" } }, { "Answer": { "Text": "Country" } } ] } }, { "Question": { "ID": "q2", "Text": "What’s your house surface area?", "Kind": "ON" } }, { "Question": { "ID": "q3", "Text": "Take a picture of a nearby object", "Kind": "IM" } }, { "Question": { "ID": "q4", "Text": "What food do you like?", "Kind": "CB", "Other": true, "Answers": [ { "Answer": { "Text": "Tacos" } }, { "Answer": { "Text": "Pozole" } }, { "Answer": { "Text": "Carnitas" } } ] } }, { "Question": { "ID": "q5", "Text": "Order the elements of this list in order of importance.", "Kind": "OL", "Answers": [ { "Answer": { "Text": "Security" } }, { "Answer": { "Text": "Comfort" } }, { "Answer": { "Text": "Price" } } ] } } ], "Title": "Chapter 1" } }, { "Chapter": { "Questions": [ { "Question": { "ID": "q6", "Text": "Are you...?", "Kind": "MC", "Other": true, "Answers": [ { "Answer": { "Text": "A woman" } }, { "Answer": { "Text": "A man" } } ] } }, { "Question": { "ID": "q7", "Text": "What’s your name?", "Kind": "OT" } }, { "Question": { "ID": "q8", "Text": "Take a picture of you.", "Kind": "IM" } }, { "Question": { "ID": "q9", "Text": "What music do you like?", "Kind": "CB", "Other": true, "Answers": [ { "Answer": { "Text": "Rock" } }, { "Answer": { "Text": "Country" } }, { "Answer": { "Text": "Polka" } } ] } }, { "Question": { "ID": "q10", "Text": "Order the elements of this list in order of importance.", "Kind": "OL", "Answers": [ { "Answer": { "Text": "Information" } }, { "Answer": { "Text": "Knowledge" } }, { "Answer": { "Text": "Wisdom" } } ] } }, { "Question": { "ID": "q11", "Text": "How many children do you have?", "Kind": "LP", "Questions": [ { "Question": { "ID": "q12", "Text": "Does he or she live with you?", "Kind": "MC", "Other": true, "Answers": [ { "Answer": { "Text": "Yes" } }, { "Answer": { "Text": "No" } } ] } } ] } }, { "Question": { "ID": "q13", "Text": "What’s his or her age?", "Kind": "ON" } }, { "Question": { "ID": "q14", "Text": "Take a picture of him or her.", "Kind": "IM" } }, { "Question": { "ID": "q15", "Text": "What cartoon does he or she like?", "Kind": "CB", "Other": true, "Answers": [ { "Answer": { "Text": "Pokémon" } }, { "Answer": { "Text": "Spirited Away" } }, { "Answer": { "Text": "My Little Pony" } } ] } }, { "Question": { "ID": "q16", "Text": "Order the elements of this list in order of importance for his or her well being", "Kind": "OL", "Answers": [ { "Answer": { "Text": "Nutrition" } }, { "Answer": { "Text": "Education" } }, { "Answer": { "Text": "Leisure time" } } ] } } ], "Title": "Chapter 2" } } ], "flockSONversion": 0.1, "Title": "Survey title" }, "TableID": "1OC0lCgrnj7OgNBjKkUxiSoQ3y92ibuXI85DMVMB9" }, "EndSurvey": { "Survey": { "Chapters": [ { "Chapter": { "Questions": [ { "Question": { "ID": "q1", "Text": "Where do you live?", "Kind": "MC", "Other": true, "Answers": [ { "Answer": { "Text": "City" } }, { "Answer": { "Text": "Country" } } ] } }, { "Question": { "ID": "q2", "Text": "What’s your house surface area?", "Kind": "ON" } }, { "Question": { "ID": "q3", "Text": "Take a picture of a nearby object", "Kind": "IM" } }, { "Question": { "ID": "q4", "Text": "What food do you like?", "Kind": "CB", "Other": true, "Answers": [ { "Answer": { "Text": "Tacos" } }, { "Answer": { "Text": "Pozole" } }, { "Answer": { "Text": "Carnitas" } } ] } }, { "Question": { "ID": "q5", "Text": "Order the elements of this list in order of importance.", "Kind": "OL", "Answers": [ { "Answer": { "Text": "Security" } }, { "Answer": { "Text": "Comfort" } }, { "Answer": { "Text": "Price" } } ] } } ], "Title": "Chapter 1" } }, { "Chapter": { "Questions": [ { "Question": { "ID": "q6", "Text": "Are you...?", "Kind": "MC", "Other": true, "Answers": [ { "Answer": { "Text": "A woman" } }, { "Answer": { "Text": "A man" } } ] } }, { "Question": { "ID": "q7", "Text": "What’s your name?", "Kind": "OT" } }, { "Question": { "ID": "q8", "Text": "Take a picture of you.", "Kind": "IM" } }, { "Question": { "ID": "q9", "Text": "What music do you like?", "Kind": "CB", "Other": true, "Answers": [ { "Answer": { "Text": "Rock" } }, { "Answer": { "Text": "Country" } }, { "Answer": { "Text": "Polka" } } ] } }, { "Question": { "ID": "q10", "Text": "Order the elements of this list in order of importance.", "Kind": "OL", "Answers": [ { "Answer": { "Text": "Information" } }, { "Answer": { "Text": "Knowledge" } }, { "Answer": { "Text": "Wisdom" } } ] } }, { "Question": { "ID": "q11", "Text": "How many children do you have?", "Kind": "LP", "Questions": [ { "Question": { "ID": "q12", "Text": "Does he or she live with you?", "Kind": "MC", "Other": true, "Answers": [ { "Answer": { "Text": "Yes" } }, { "Answer": { "Text": "No" } } ] } } ] } }, { "Question": { "ID": "q13", "Text": "What’s his or her age?", "Kind": "ON" } }, { "Question": { "ID": "q14", "Text": "Take a picture of him or her.", "Kind": "IM" } }, { "Question": { "ID": "q15", "Text": "What cartoon does he or she like?", "Kind": "CB", "Other": true, "Answers": [ { "Answer": { "Text": "Pokémon" } }, { "Answer": { "Text": "Spirited Away" } }, { "Answer": { "Text": "My Little Pony" } } ] } }, { "Question": { "ID": "q16", "Text": "Order the elements of this list in order of importance for his or her well being", "Kind": "OL", "Answers": [ { "Answer": { "Text": "Nutrition" } }, { "Answer": { "Text": "Education" } }, { "Answer": { "Text": "Leisure time" } } ] } } ], "Title": "Chapter 2" } } ], "flockSONversion": 0.1, "Title": "Survey title" }, "TableID": "1OvGFdM5wViaS78g3pGpJsHDKZ0vN7maPb4qNjmRR" }, "Tracker": { "TableID": "1Sgw05bWkYDFy_N1NUtqWZxdBYJPDdMtWKzMjowJM" } }, "FlocktrackerProjectVersion": 0.1 } }';
		var ftpr = new FT_pr(); // Flocktracker models;
		var ftprB = new FT_pb(); // Flocktracker views
    	var FTproject = new ftpr.project();
    	var uC = new this.undoHandler();
    	FTproject.deserializeJSON(superString);
    	console.log(JSON.stringify(FTproject.serializeJSON()));
    	var projectView = new ftprB.projectView(FTproject, this.uC);
    	var container = document.getElementById("survey_container");
    	container.appendChild(projectView.getView());
    	var jsonText = document.getElementById('JsonGoesHere');
    	var modCount = document.getElementById("modification_count");
		var contentChanges = -1;
		var uStack = new undoStack();
		undo = document.getElementById("undo");
		var that = this;
		undo.onclick = function() {
			var undoStackElement = that.uStack.undo();
			that.FTproject = undoStackElement.objectState;
			undoStackElement.view.updateContent(that.FTproject);
			contentChanges--;
			that.modCount.innerHTML = contentChanges;
			that.jsonText.innerHTML = JSON.stringify(that.FTproject.serializeJSON());
			$(undo).attr('disabled', !that.uStack.isUndoPossible());
			$(redo).attr('disabled', !that.uStack.isRedoPossible());   
		}
		$(undo).attr('disabled', true);
		var redo = document.getElementById("redo");
		redo.onclick = function() {
			var redoStackElement = that.uStack.redo();
			that.FTproject = redoStackElement.objectState;
			redoStackElement.view.updateContent(that.FTproject);
			contentChanges++;
			that.modCount.innerHTML = contentChanges;
			that.jsonText.innerHTML = JSON.stringify(that.FTproject.serializeJSON());
			$(undo).attr('disabled', !that.uStack.isUndoPossible());
			$(redo).attr('disabled', !that.uStack.isRedoPossible()); 
		}
		$(redo).attr('disabled', true);
		uC.contentChanged();
		var parseButton = document.getElementById("parse_button");
		var projectInput = document.getElementById("project_input");
		parseButton.onclick = function(){
			FTproject.deserializeJSON(projectInput.value);
			projectView.updateContent(FTproject);
		}
    </script>
</html>